<template>
  <div class="pet-customizer">
    <!-- Â§¥ÈÉ®Ê†áÈ¢ò -->
    <div class="customizer-header">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">üé® ÂÆ†Áâ©ÈÄ†ÂûãÂ∏à</h2>
      <p class="text-gray-600 mb-6">ÊâìÈÄ†ÊÇ®Áã¨‰∏ÄÊó†‰∫åÁöÑ‰∏ìÂ±ûÂÆ†Áâ©</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Â∑¶‰æßÔºöÂÆ†Áâ©È¢ÑËßà -->
      <div class="pet-preview-section">
        <div class="bg-gradient-to-br from-blue-100 to-purple-100 rounded-3xl p-8 shadow-lg">
          <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">È¢ÑËßàÊïàÊûú</h3>
          <div class="flex justify-center items-center min-h-64">
            <PetRenderer 
              :petData="{ appearance: currentAppearance }"
              :size="280"
              :interactive="true"
              :animationState="animationState"
              :mood="currentMood"
            />
          </div>
          
          <!-- Âä®ÁîªÊéßÂà∂ -->
          <div class="mt-6">
            <h4 class="text-sm font-medium text-gray-600 mb-3">Âä®ÁîªÈ¢ÑËßà</h4>
            <div class="flex flex-wrap gap-2 justify-center">
              <button 
                v-for="animation in animations" 
                :key="animation.id"
                @click="animationState = animation.id"
                :class="[
                  'px-3 py-1 rounded-full text-xs font-medium transition-all',
                  animationState === animation.id 
                    ? 'bg-blue-500 text-white' 
                    : 'bg-white text-gray-600 hover:bg-blue-50'
                ]"
              >
                {{ animation.emoji }} {{ animation.name }}
              </button>
            </div>
          </div>

          <!-- ÊÉÖÁª™ÊéßÂà∂ -->
          <div class="mt-4">
            <h4 class="text-sm font-medium text-gray-600 mb-3">ÊÉÖÁª™Ë°®Ëææ</h4>
            <div class="flex flex-wrap gap-2 justify-center">
              <button 
                v-for="mood in moods" 
                :key="mood.id"
                @click="currentMood = mood.id"
                :class="[
                  'px-3 py-1 rounded-full text-xs font-medium transition-all',
                  currentMood === mood.id 
                    ? 'bg-pink-500 text-white' 
                    : 'bg-white text-gray-600 hover:bg-pink-50'
                ]"
              >
                {{ mood.emoji }} {{ mood.name }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Âè≥‰æßÔºöËá™ÂÆö‰πâÈÄâÈ°π -->
      <div class="customization-options">
        <div class="bg-white rounded-3xl p-6 shadow-lg max-h-96 overflow-y-auto">
          <!-- Ê†áÁ≠æÈ°µÂØºËà™ -->
          <div class="tabs-nav mb-6">
            <div class="flex flex-wrap border-b border-gray-200">
              <button 
                v-for="tab in tabs" 
                :key="tab.id"
                @click="activeTab = tab.id"
                :class="[
                  'px-4 py-2 text-sm font-medium border-b-2 transition-colors',
                  activeTab === tab.id
                    ? 'border-indigo-500 text-indigo-600'
                    : 'border-transparent text-gray-500 hover:text-gray-700'
                ]"
              >
                {{ tab.icon }} {{ tab.name }}
              </button>
            </div>
          </div>

          <!-- Ë∫´‰ΩìÈÉ®‰Ωç -->
          <div v-if="activeTab === 'body'" class="customization-panel">
            <div class="space-y-6">
              <!-- Â§¥ÈÉ®ÂΩ¢Áä∂ -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">Â§¥ÈÉ®ÂΩ¢Áä∂</label>
                <div class="grid grid-cols-2 gap-2">
                  <button 
                    v-for="shape in headShapes" 
                    :key="shape.id"
                    @click="currentAppearance.bodyParts.headShape = shape.id"
                    :class="[
                      'p-3 border-2 rounded-lg text-center transition-all',
                      currentAppearance.bodyParts.headShape === shape.id
                        ? 'border-indigo-500 bg-indigo-50'
                        : 'border-gray-200 hover:border-indigo-300'
                    ]"
                  >
                    <div class="text-2xl mb-1">{{ shape.emoji }}</div>
                    <div class="text-xs text-gray-600">{{ shape.name }}</div>
                  </button>
                </div>
              </div>

              <!-- ËÄ≥ÊúµÁ±ªÂûã -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">ËÄ≥ÊúµÁ±ªÂûã</label>
                <div class="grid grid-cols-3 gap-2">
                  <button 
                    v-for="ear in earTypes" 
                    :key="ear.id"
                    @click="currentAppearance.bodyParts.earType = ear.id"
                    :class="[
                      'p-3 border-2 rounded-lg text-center transition-all',
                      currentAppearance.bodyParts.earType === ear.id
                        ? 'border-indigo-500 bg-indigo-50'
                        : 'border-gray-200 hover:border-indigo-300'
                    ]"
                  >
                    <div class="text-2xl mb-1">{{ ear.emoji }}</div>
                    <div class="text-xs text-gray-600">{{ ear.name }}</div>
                  </button>
                </div>
              </div>

              <!-- ÁúºÁùõÁ±ªÂûã -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">ÁúºÁùõÁ±ªÂûã</label>
                <div class="grid grid-cols-3 gap-2">
                  <button 
                    v-for="eye in eyeTypes" 
                    :key="eye.id"
                    @click="currentAppearance.bodyParts.eyeType = eye.id"
                    :class="[
                      'p-3 border-2 rounded-lg text-center transition-all',
                      currentAppearance.bodyParts.eyeType === eye.id
                        ? 'border-indigo-500 bg-indigo-50'
                        : 'border-gray-200 hover:border-indigo-300'
                    ]"
                  >
                    <div class="text-2xl mb-1">{{ eye.emoji }}</div>
                    <div class="text-xs text-gray-600">{{ eye.name }}</div>
                  </button>
                </div>
              </div>

              <!-- Âò¥Â∑¥Á±ªÂûã -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">Âò¥Â∑¥Á±ªÂûã</label>
                <div class="grid grid-cols-3 gap-2">
                  <button 
                    v-for="mouth in mouthTypes" 
                    :key="mouth.id"
                    @click="currentAppearance.bodyParts.mouthType = mouth.id"
                    :class="[
                      'p-3 border-2 rounded-lg text-center transition-all',
                      currentAppearance.bodyParts.mouthType === mouth.id
                        ? 'border-indigo-500 bg-indigo-50'
                        : 'border-gray-200 hover:border-indigo-300'
                    ]"
                  >
                    <div class="text-2xl mb-1">{{ mouth.emoji }}</div>
                    <div class="text-xs text-gray-600">{{ mouth.name }}</div>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- È¢úËâ≤ÊñπÊ°à -->
          <div v-if="activeTab === 'colors'" class="customization-panel">
            <div class="space-y-6">
              <!-- ‰∏ªË¶ÅÈ¢úËâ≤ -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">‰∏ªË¶ÅÈ¢úËâ≤</label>
                <div class="flex items-center space-x-3">
                  <input 
                    type="color" 
                    v-model="currentAppearance.colorScheme.primaryColor"
                    class="w-12 h-12 rounded-lg border-2 border-gray-300 cursor-pointer"
                  />
                  <div class="flex-1">
                    <div class="grid grid-cols-6 gap-2">
                      <button 
                        v-for="color in colorPalette" 
                        :key="color"
                        @click="currentAppearance.colorScheme.primaryColor = color"
                        :style="{ backgroundColor: color }"
                        class="w-8 h-8 rounded-lg border-2 border-gray-300 hover:scale-110 transition-transform"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- ËæÖÂä©È¢úËâ≤ -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">ËæÖÂä©È¢úËâ≤</label>
                <div class="flex items-center space-x-3">
                  <input 
                    type="color" 
                    v-model="currentAppearance.colorScheme.secondaryColor"
                    class="w-12 h-12 rounded-lg border-2 border-gray-300 cursor-pointer"
                  />
                  <div class="flex-1">
                    <div class="grid grid-cols-6 gap-2">
                      <button 
                        v-for="color in colorPalette" 
                        :key="`secondary-${color}`"
                        @click="currentAppearance.colorScheme.secondaryColor = color"
                        :style="{ backgroundColor: color }"
                        class="w-8 h-8 rounded-lg border-2 border-gray-300 hover:scale-110 transition-transform"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- ÁúºÁùõÈ¢úËâ≤ -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">ÁúºÁùõÈ¢úËâ≤</label>
                <div class="space-y-3">
                  <!-- ÊòØÂê¶ÂºÇÁû≥ -->
                  <div class="flex items-center space-x-3">
                    <input 
                      type="checkbox" 
                      id="heterochromia"
                      v-model="isHeterochromia"
                      @change="handleHeterochromiaChange"
                      class="rounded"
                    />
                    <label for="heterochromia" class="text-sm text-gray-600">ÂºÇÁû≥Ôºà‰∏çÂêåÈ¢úËâ≤ÁöÑÁúºÁùõÔºâ</label>
                  </div>
                  
                  <!-- Â∑¶ÁúºÈ¢úËâ≤ -->
                  <div>
                    <label class="block text-xs text-gray-500 mb-1">
                      {{ isHeterochromia ? 'Â∑¶ÁúºÈ¢úËâ≤' : 'ÁúºÁùõÈ¢úËâ≤' }}
                    </label>
                    <div class="flex items-center space-x-3">
                      <input 
                        type="color" 
                        v-model="currentAppearance.colorScheme.leftEyeColor"
                        @input="handleEyeColorChange"
                        class="w-10 h-10 rounded-lg border-2 border-gray-300 cursor-pointer"
                      />
                      <div class="grid grid-cols-6 gap-1">
                        <button 
                          v-for="color in eyeColors" 
                          :key="`left-eye-${color}`"
                          @click="setEyeColor(color, 'left')"
                          :style="{ backgroundColor: color }"
                          class="w-6 h-6 rounded-full border border-gray-300 hover:scale-110 transition-transform"
                        />
                      </div>
                    </div>
                  </div>

                  <!-- Âè≥ÁúºÈ¢úËâ≤Ôºà‰ªÖÂú®ÂºÇÁû≥Êó∂ÊòæÁ§∫Ôºâ -->
                  <div v-if="isHeterochromia">
                    <label class="block text-xs text-gray-500 mb-1">Âè≥ÁúºÈ¢úËâ≤</label>
                    <div class="flex items-center space-x-3">
                      <input 
                        type="color" 
                        v-model="currentAppearance.colorScheme.rightEyeColor"
                        class="w-10 h-10 rounded-lg border-2 border-gray-300 cursor-pointer"
                      />
                      <div class="grid grid-cols-6 gap-1">
                        <button 
                          v-for="color in eyeColors" 
                          :key="`right-eye-${color}`"
                          @click="setEyeColor(color, 'right')"
                          :style="{ backgroundColor: color }"
                          class="w-6 h-6 rounded-full border border-gray-300 hover:scale-110 transition-transform"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ÈºªÂ≠êÈ¢úËâ≤ -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">ÈºªÂ≠êÈ¢úËâ≤</label>
                <div class="flex items-center space-x-3">
                  <input 
                    type="color" 
                    v-model="currentAppearance.colorScheme.noseColor"
                    class="w-10 h-10 rounded-lg border-2 border-gray-300 cursor-pointer"
                  />
                  <div class="grid grid-cols-4 gap-2">
                    <button 
                      v-for="color in noseColors" 
                      :key="color"
                      @click="currentAppearance.colorScheme.noseColor = color"
                      :style="{ backgroundColor: color }"
                      class="w-8 h-8 rounded-lg border border-gray-300 hover:scale-110 transition-transform"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ÂõæÊ°à -->
          <div v-if="activeTab === 'patterns'" class="customization-panel">
            <div class="space-y-6">
              <!-- ÂõæÊ°àÁ±ªÂûã -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">ÂõæÊ°àÁ±ªÂûã</label>
                <div class="grid grid-cols-2 gap-2">
                  <button 
                    v-for="pattern in patternTypes" 
                    :key="pattern.id"
                    @click="currentAppearance.patternConfig.type = pattern.id"
                    :class="[
                      'p-3 border-2 rounded-lg text-center transition-all',
                      currentAppearance.patternConfig.type === pattern.id
                        ? 'border-purple-500 bg-purple-50'
                        : 'border-gray-200 hover:border-purple-300'
                    ]"
                  >
                    <div class="text-2xl mb-1">{{ pattern.emoji }}</div>
                    <div class="text-xs text-gray-600">{{ pattern.name }}</div>
                  </button>
                </div>
              </div>

              <!-- ÂõæÊ°àÈ¢úËâ≤ -->
              <div v-if="currentAppearance.patternConfig.type !== 'none'" class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">ÂõæÊ°àÈ¢úËâ≤</label>
                <div class="flex items-center space-x-3">
                  <input 
                    type="color" 
                    v-model="currentAppearance.patternConfig.color"
                    class="w-12 h-12 rounded-lg border-2 border-gray-300 cursor-pointer"
                  />
                  <div class="grid grid-cols-6 gap-2">
                    <button 
                      v-for="color in colorPalette" 
                      :key="`pattern-${color}`"
                      @click="currentAppearance.patternConfig.color = color"
                      :style="{ backgroundColor: color }"
                      class="w-8 h-8 rounded-lg border-2 border-gray-300 hover:scale-110 transition-transform"
                    />
                  </div>
                </div>
              </div>

              <!-- ÂõæÊ°àÈÄèÊòéÂ∫¶ -->
              <div v-if="currentAppearance.patternConfig.type !== 'none'" class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  ÂõæÊ°àÈÄèÊòéÂ∫¶: {{ Math.round(currentAppearance.patternConfig.opacity * 100) }}%
                </label>
                <input 
                  type="range" 
                  min="0.1" 
                  max="1" 
                  step="0.1"
                  v-model="currentAppearance.patternConfig.opacity"
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                />
              </div>
            </div>
          </div>

          <!-- Ë£ÖÈ•∞ÂìÅ -->
          <div v-if="activeTab === 'accessories'" class="customization-panel">
            <div class="space-y-6">
              <!-- Â∏ΩÂ≠ê -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">Â∏ΩÂ≠ê</label>
                <div class="grid grid-cols-3 gap-2">
                  <button 
                    v-for="hat in hatTypes" 
                    :key="hat.id"
                    @click="currentAppearance.accessoryConfig.hatType = hat.id"
                    :class="[
                      'p-3 border-2 rounded-lg text-center transition-all',
                      currentAppearance.accessoryConfig.hatType === hat.id
                        ? 'border-green-500 bg-green-50'
                        : 'border-gray-200 hover:border-green-300'
                    ]"
                  >
                    <div class="text-2xl mb-1">{{ hat.emoji }}</div>
                    <div class="text-xs text-gray-600">{{ hat.name }}</div>
                  </button>
                </div>
              </div>

              <!-- È°πÂúà -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">È°πÂúà</label>
                <div class="grid grid-cols-3 gap-2">
                  <button 
                    v-for="collar in collarTypes" 
                    :key="collar.id"
                    @click="currentAppearance.accessoryConfig.collarType = collar.id"
                    :class="[
                      'p-3 border-2 rounded-lg text-center transition-all',
                      currentAppearance.accessoryConfig.collarType === collar.id
                        ? 'border-green-500 bg-green-50'
                        : 'border-gray-200 hover:border-green-300'
                    ]"
                  >
                    <div class="text-2xl mb-1">{{ collar.emoji }}</div>
                    <div class="text-xs text-gray-600">{{ collar.name }}</div>
                  </button>
                </div>
              </div>

              <!-- ÁúºÈïú -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">ÁúºÈïú</label>
                <div class="grid grid-cols-2 gap-2">
                  <button 
                    v-for="glasses in glassesTypes" 
                    :key="glasses.id"
                    @click="currentAppearance.accessoryConfig.glassesType = glasses.id"
                    :class="[
                      'p-3 border-2 rounded-lg text-center transition-all',
                      currentAppearance.accessoryConfig.glassesType === glasses.id
                        ? 'border-green-500 bg-green-50'
                        : 'border-gray-200 hover:border-green-300'
                    ]"
                  >
                    <div class="text-2xl mb-1">{{ glasses.emoji }}</div>
                    <div class="text-xs text-gray-600">{{ glasses.name }}</div>
                  </button>
                </div>
              </div>

              <!-- Ë£ÖÈ•∞ÂìÅÈ¢úËâ≤ -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">Ë£ÖÈ•∞ÂìÅÈ¢úËâ≤</label>
                <div class="space-y-3">
                  <div v-if="currentAppearance.accessoryConfig.hatType !== 'none'">
                    <label class="block text-xs text-gray-500 mb-1">Â∏ΩÂ≠êÈ¢úËâ≤</label>
                    <div class="grid grid-cols-6 gap-2">
                      <button 
                        v-for="color in accessoryColors" 
                        :key="`hat-${color}`"
                        @click="currentAppearance.accessoryConfig.accessoryColors.hat = color"
                        :style="{ backgroundColor: color }"
                        class="w-8 h-8 rounded-lg border-2 border-gray-300 hover:scale-110 transition-transform"
                      />
                    </div>
                  </div>
                  
                  <div v-if="currentAppearance.accessoryConfig.collarType !== 'none'">
                    <label class="block text-xs text-gray-500 mb-1">È°πÂúàÈ¢úËâ≤</label>
                    <div class="grid grid-cols-6 gap-2">
                      <button 
                        v-for="color in accessoryColors" 
                        :key="`collar-${color}`"
                        @click="currentAppearance.accessoryConfig.accessoryColors.collar = color"
                        :style="{ backgroundColor: color }"
                        class="w-8 h-8 rounded-lg border-2 border-gray-300 hover:scale-110 transition-transform"
                      />
                    </div>
                  </div>
                  
                  <div v-if="currentAppearance.accessoryConfig.glassesType !== 'none'">
                    <label class="block text-xs text-gray-500 mb-1">ÁúºÈïúÈ¢úËâ≤</label>
                    <div class="grid grid-cols-6 gap-2">
                      <button 
                        v-for="color in accessoryColors" 
                        :key="`glasses-${color}`"
                        @click="currentAppearance.accessoryConfig.accessoryColors.glasses = color"
                        :style="{ backgroundColor: color }"
                        class="w-8 h-8 rounded-lg border-2 border-gray-300 hover:scale-110 transition-transform"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ë∫´‰ΩìÊØî‰æã -->
          <div v-if="activeTab === 'proportions'" class="customization-panel">
            <div class="space-y-6">
              <!-- ËÉñÁò¶Á®ãÂ∫¶ -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  ËÉñÁò¶Á®ãÂ∫¶: {{ getFatnessLabel(currentAppearance.bodyProportions.fatness) }}
                </label>
                <input 
                  type="range" 
                  min="20" 
                  max="80" 
                  v-model="currentAppearance.bodyProportions.fatness"
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                />
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                  <span>Áò¶</span>
                  <span>ËÉñ</span>
                </div>
              </div>

              <!-- È´òÁüÆÁ®ãÂ∫¶ -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  È´òÁüÆÁ®ãÂ∫¶: {{ getHeightLabel(currentAppearance.bodyProportions.height) }}
                </label>
                <input 
                  type="range" 
                  min="30" 
                  max="70" 
                  v-model="currentAppearance.bodyProportions.height"
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                />
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                  <span>ÁüÆ</span>
                  <span>È´ò</span>
                </div>
              </div>

              <!-- Â§¥ÈÉ®Â§ßÂ∞è -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  Â§¥ÈÉ®Â§ßÂ∞è: {{ getHeadSizeLabel(currentAppearance.bodyProportions.headSize) }}
                </label>
                <input 
                  type="range" 
                  min="30" 
                  max="70" 
                  v-model="currentAppearance.bodyProportions.headSize"
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                />
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                  <span>Â∞è</span>
                  <span>Â§ß</span>
                </div>
              </div>

              <!-- ÁúºÁùõÂ§ßÂ∞è -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  ÁúºÁùõÂ§ßÂ∞è: {{ getEyeSizeLabel(currentAppearance.bodyProportions.eyeSize) }}
                </label>
                <input 
                  type="range" 
                  min="30" 
                  max="70" 
                  v-model="currentAppearance.bodyProportions.eyeSize"
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                />
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                  <span>Â∞è</span>
                  <span>Â§ß</span>
                </div>
              </div>

              <!-- ËÄ≥ÊúµÂ§ßÂ∞è -->
              <div class="option-group">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                  ËÄ≥ÊúµÂ§ßÂ∞è: {{ getEarSizeLabel(currentAppearance.bodyProportions.earSize) }}
                </label>
                <input 
                  type="range" 
                  min="30" 
                  max="70" 
                  v-model="currentAppearance.bodyProportions.earSize"
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                />
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                  <span>Â∞è</span>
                  <span>Â§ß</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
    <div class="customizer-footer mt-8">
      <div class="flex justify-center space-x-4">
        <button 
          @click="resetToDefault"
          class="px-6 py-3 bg-gray-500 text-white font-semibold rounded-2xl hover:bg-gray-600 transition-colors"
        >
          üîÑ ÈáçÁΩÆÈªòËÆ§
        </button>
        <button 
          @click="saveAppearance"
          :disabled="saving"
          class="px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white font-semibold rounded-2xl hover:from-purple-600 hover:to-pink-700 disabled:opacity-50 transition-all transform hover:scale-105"
        >
          {{ saving ? '‰øùÂ≠ò‰∏≠...' : 'üíæ ‰øùÂ≠òÈÄ†Âûã' }}
        </button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed, onMounted, watch } from 'vue'
import PetRenderer from './PetRenderer.vue'

// Props and Emits
interface Props {
  petData?: any
  visible?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  visible: false
})

const emits = defineEmits<{
  save: [appearance: any]
  cancel: []
}>()

// Reactive data
const activeTab = ref('body')
const animationState = ref('idle')
const currentMood = ref('neutral')
const saving = ref(false)
const isHeterochromia = ref(false)

// ÂΩìÂâçÂ§ñËßÇÈÖçÁΩÆ
const currentAppearance = reactive({
  bodyParts: {
    headShape: 'round',
    earType: 'pointed',
    eyeType: 'large',
    mouthType: 'small',
    tailType: 'normal'
  },
  colorScheme: {
    primaryColor: '#FF8C00',
    secondaryColor: '#FFA500',
    leftEyeColor: '#0000FF',
    rightEyeColor: '#0000FF',
    noseColor: '#FFB6C1'
  },
  patternConfig: {
    type: 'none',
    color: '#000000',
    opacity: 0.7
  },
  accessoryConfig: {
    hatType: 'none',
    collarType: 'none',
    glassesType: 'none',
    accessoryColors: {
      hat: '#FF0000',
      collar: '#00FF00',
      glasses: '#000000'
    }
  },
  bodyProportions: {
    fatness: 50,
    height: 50,
    headSize: 50,
    eyeSize: 50,
    earSize: 50
  }
})

// UI ÈÖçÁΩÆÊï∞ÊçÆ
const tabs = [
  { id: 'body', name: 'Ë∫´‰ΩìÈÉ®‰Ωç', icon: 'ü¶¥' },
  { id: 'colors', name: 'È¢úËâ≤', icon: 'üé®' },
  { id: 'patterns', name: 'ÂõæÊ°à', icon: 'üåü' },
  { id: 'accessories', name: 'Ë£ÖÈ•∞ÂìÅ', icon: 'üëë' },
  { id: 'proportions', name: 'ÊØî‰æã', icon: 'üìè' }
]

const animations = [
  { id: 'idle', name: 'Èó≤ÁΩÆ', emoji: 'üò¥' },
  { id: 'walking', name: 'Ë°åËµ∞', emoji: 'üö∂' },
  { id: 'playing', name: 'Áé©ËÄç', emoji: 'üéæ' },
  { id: 'eating', name: 'ËøõÈ£ü', emoji: 'üçΩÔ∏è' },
  { id: 'sleeping', name: 'Áù°Ëßâ', emoji: 'üí§' }
]

const moods = [
  { id: 'neutral', name: 'Âπ≥Èùô', emoji: 'üòê' },
  { id: 'happy', name: 'ÂºÄÂøÉ', emoji: 'üòä' },
  { id: 'sleepy', name: 'Âõ∞ÂÄ¶', emoji: 'üò¥' },
  { id: 'angry', name: 'ÁîüÊ∞î', emoji: 'üò†' },
  { id: 'curious', name: 'Â•ΩÂ•á', emoji: 'ü§î' }
]

const headShapes = [
  { id: 'round', name: 'ÂúÜÂΩ¢', emoji: '‚≠ï' },
  { id: 'oval', name: 'Ê§≠ÂúÜ', emoji: 'ü•ö' },
  { id: 'square', name: 'ÊñπÂΩ¢', emoji: '‚¨ú' },
  { id: 'triangular', name: '‰∏âËßí', emoji: 'üî∫' }
]

const earTypes = [
  { id: 'pointed', name: 'Â∞ñËÄ≥', emoji: 'üî∫' },
  { id: 'round', name: 'ÂúÜËÄ≥', emoji: '‚≠ï' },
  { id: 'floppy', name: 'ÂûÇËÄ≥', emoji: 'üëÇ' },
  { id: 'long', name: 'ÈïøËÄ≥', emoji: 'üê∞' },
  { id: 'horn', name: 'ËßíÁä∂', emoji: 'ü¶Ñ' },
  { id: 'none', name: 'Êó†ËÄ≥', emoji: '‚ö´' }
]

const eyeTypes = [
  { id: 'large', name: 'Â§ßÁúº', emoji: 'üëÄ' },
  { id: 'small', name: 'Â∞èÁúº', emoji: 'üëÅÔ∏è' },
  { id: 'sleepy', name: 'ÁúØÁúØÁúº', emoji: 'üò¥' },
  { id: 'mysterious', name: 'Á•ûÁßò', emoji: 'üîÆ' },
  { id: 'friendly', name: 'ÂèãÂñÑ', emoji: 'üòä' }
]

const mouthTypes = [
  { id: 'small', name: 'Â∞èÂò¥', emoji: 'üòÆ' },
  { id: 'open', name: 'Âº†Âò¥', emoji: 'üò≤' },
  { id: 'tiny', name: 'ÂæÆÂº†', emoji: 'üòó' },
  { id: 'wise', name: 'ÁùøÊô∫', emoji: 'üßô' },
  { id: 'content', name: 'Êª°Ë∂≥', emoji: 'üòå' },
  { id: 'beak', name: 'È∏üÂò¥', emoji: 'üê¶' }
]

const patternTypes = [
  { id: 'none', name: 'Êó†ÂõæÊ°à', emoji: '‚ö´' },
  { id: 'stripes', name: 'Êù°Á∫π', emoji: 'ü¶ì' },
  { id: 'spots', name: 'ÊñëÁÇπ', emoji: 'üêÜ' },
  { id: 'gradient', name: 'Ê∏êÂèò', emoji: 'üåà' },
  { id: 'heart', name: 'Áà±ÂøÉ', emoji: 'üíñ' },
  { id: 'scales', name: 'È≥ûÁâá', emoji: 'üêâ' }
]

const hatTypes = [
  { id: 'none', name: 'Êó†Â∏ΩÂ≠ê', emoji: '‚ö´' },
  { id: 'baseball_cap', name: 'Ê£íÁêÉÂ∏Ω', emoji: 'üß¢' },
  { id: 'beret', name: 'Ë¥ùÈõ∑Â∏Ω', emoji: 'üë®‚Äçüé®' },
  { id: 'crown', name: 'ÁéãÂÜ†', emoji: 'üëë' },
  { id: 'bow', name: 'Ëù¥Ëù∂Áªì', emoji: 'üéÄ' }
]

const collarTypes = [
  { id: 'none', name: 'Êó†È°πÂúà', emoji: '‚ö´' },
  { id: 'bow_tie', name: 'Ëù¥Ëù∂Áªì', emoji: 'üéÄ' },
  { id: 'bell', name: 'ÈìÉÈìõ', emoji: 'üîî' },
  { id: 'flower_wreath', name: 'Ëä±ÁéØ', emoji: 'üå∏' }
]

const glassesTypes = [
  { id: 'none', name: 'Êó†ÁúºÈïú', emoji: '‚ö´' },
  { id: 'round_glasses', name: 'ÂúÜÊ°ÜÈïú', emoji: 'ü§ì' },
  { id: 'sunglasses', name: 'Â¢®Èïú', emoji: 'üòé' },
  { id: 'monocle', name: 'ÂçïÁâáÈïú', emoji: 'üßê' }
]

// È¢úËâ≤ÈÖçÁΩÆ
const colorPalette = [
  '#FF8C00', '#8B4513', '#FFFFFF', '#F4A460', '#9932CC', '#000000',
  '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF',
  '#FFA500', '#DEB887', '#F0F0F0', '#FFE4B5', '#8A2BE2', '#696969',
  '#FF4500', '#32CD32', '#4169E1', '#FFD700', '#DA70D6', '#40E0D0'
]

const eyeColors = [
  '#0000FF', '#00FF00', '#8B4513', '#9932CC', '#FF1493', '#32CD32',
  '#FF6347', '#4169E1', '#FFD700', '#FF69B4', '#00CED1', '#FFA500'
]

const noseColors = [
  '#FFB6C1', '#000000', '#8B4513', '#FF69B4'
]

const accessoryColors = [
  '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF',
  '#FFA500', '#9932CC', '#FFD700', '#FF69B4', '#32CD32', '#FF6347'
]

// ËÆ°ÁÆóÂ±ûÊÄßÂíåÊñπÊ≥ï
const getFatnessLabel = (value: number) => {
  if (value < 35) return 'ÂÅèÁò¶'
  if (value < 65) return 'ÈÄÇ‰∏≠'
  return 'ÂÅèËÉñ'
}

const getHeightLabel = (value: number) => {
  if (value < 40) return 'ËæÉÁüÆ'
  if (value < 60) return 'ÈÄÇ‰∏≠'
  return 'ËæÉÈ´ò'
}

const getHeadSizeLabel = (value: number) => {
  if (value < 40) return 'ËæÉÂ∞è'
  if (value < 60) return 'ÈÄÇ‰∏≠'
  return 'ËæÉÂ§ß'
}

const getEyeSizeLabel = (value: number) => {
  if (value < 40) return 'ËæÉÂ∞è'
  if (value < 60) return 'ÈÄÇ‰∏≠'
  return 'ËæÉÂ§ß'
}

const getEarSizeLabel = (value: number) => {
  if (value < 40) return 'ËæÉÂ∞è'
  if (value < 60) return 'ÈÄÇ‰∏≠'
  return 'ËæÉÂ§ß'
}

const handleHeterochromiaChange = () => {
  if (!isHeterochromia.value) {
    currentAppearance.colorScheme.rightEyeColor = currentAppearance.colorScheme.leftEyeColor
  }
}

const handleEyeColorChange = () => {
  if (!isHeterochromia.value) {
    currentAppearance.colorScheme.rightEyeColor = currentAppearance.colorScheme.leftEyeColor
  }
}

const setEyeColor = (color: string, eye: 'left' | 'right') => {
  if (eye === 'left') {
    currentAppearance.colorScheme.leftEyeColor = color
    if (!isHeterochromia.value) {
      currentAppearance.colorScheme.rightEyeColor = color
    }
  } else {
    currentAppearance.colorScheme.rightEyeColor = color
  }
}

const resetToDefault = () => {
  // ÈáçÁΩÆ‰∏∫ÈªòËÆ§Â§ñËßÇ
  Object.assign(currentAppearance, {
    bodyParts: {
      headShape: 'round',
      earType: 'pointed',
      eyeType: 'large',
      mouthType: 'small',
      tailType: 'normal'
    },
    colorScheme: {
      primaryColor: '#FF8C00',
      secondaryColor: '#FFA500',
      leftEyeColor: '#0000FF',
      rightEyeColor: '#0000FF',
      noseColor: '#FFB6C1'
    },
    patternConfig: {
      type: 'none',
      color: '#000000',
      opacity: 0.7
    },
    accessoryConfig: {
      hatType: 'none',
      collarType: 'none',
      glassesType: 'none',
      accessoryColors: {
        hat: '#FF0000',
        collar: '#00FF00',
        glasses: '#000000'
      }
    },
    bodyProportions: {
      fatness: 50,
      height: 50,
      headSize: 50,
      eyeSize: 50,
      earSize: 50
    }
  })
  isHeterochromia.value = false
}

const saveAppearance = async () => {
  saving.value = true
  try {
    // ÂèëÈÄÅ‰øùÂ≠òËØ∑Ê±Ç
    emits('save', currentAppearance)
    // Ê®°ÊãüAPIË∞ÉÁî®Âª∂Ëøü
    await new Promise(resolve => setTimeout(resolve, 500))
  } finally {
    saving.value = false
  }
}

// ÁõëÂê¨ÂºÇÁû≥Áä∂ÊÄÅ
watch(() => currentAppearance.colorScheme.leftEyeColor, () => {
  if (currentAppearance.colorScheme.leftEyeColor !== currentAppearance.colorScheme.rightEyeColor) {
    isHeterochromia.value = true
  }
})

watch(() => currentAppearance.colorScheme.rightEyeColor, () => {
  if (currentAppearance.colorScheme.leftEyeColor !== currentAppearance.colorScheme.rightEyeColor) {
    isHeterochromia.value = true
  }
})

// ÂàùÂßãÂåñ
onMounted(() => {
  if (props.petData?.appearance) {
    Object.assign(currentAppearance, props.petData.appearance)
    // Ê£ÄÊü•ÊòØÂê¶‰∏∫ÂºÇÁû≥
    isHeterochromia.value = currentAppearance.colorScheme.leftEyeColor !== currentAppearance.colorScheme.rightEyeColor
  }
})
</script>

<style scoped>
.pet-customizer {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.customizer-header {
  text-align: center;
  margin-bottom: 2rem;
}

.customization-panel {
  min-height: 200px;
}

.option-group {
  margin-bottom: 1.5rem;
}

.option-group:last-child {
  margin-bottom: 0;
}

/* Ëá™ÂÆö‰πâÊªëÂùóÊ†∑Âºè */
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  height: 20px;
  width: 20px;
  border-radius: 50%;
  background: #4F46E5;
  cursor: pointer;
  border: 2px solid #ffffff;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

input[type="range"]::-moz-range-thumb {
  height: 20px;
  width: 20px;
  border-radius: 50%;
  background: #4F46E5;
  cursor: pointer;
  border: 2px solid #ffffff;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

/* Ëá™ÂÆö‰πâÈ¢úËâ≤ÈÄâÊã©Âô®Ê†∑Âºè */
input[type="color"] {
  -webkit-appearance: none;
  border: none;
  cursor: pointer;
}

input[type="color"]::-webkit-color-swatch-wrapper {
  padding: 0;
}

input[type="color"]::-webkit-color-swatch {
  border: none;
  border-radius: 8px;
}

/* ÊªöÂä®Êù°Ê†∑Âºè */
.customization-options > div {
  scrollbar-width: thin;
  scrollbar-color: #CBD5E0 #F7FAFC;
}

.customization-options > div::-webkit-scrollbar {
  width: 6px;
}

.customization-options > div::-webkit-scrollbar-track {
  background: #F7FAFC;
  border-radius: 3px;
}

.customization-options > div::-webkit-scrollbar-thumb {
  background: #CBD5E0;
  border-radius: 3px;
}

.customization-options > div::-webkit-scrollbar-thumb:hover {
  background: #A0AEC0;
}

/* ÁßªÂä®Á´Ø‰ºòÂåñ */
@media (max-width: 768px) {
  .pet-customizer {
    padding: 15px;
  }
  
  .grid.lg\\:grid-cols-2 {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .customization-options > div {
    max-height: 60vh;
  }
  
  .tabs-nav .flex {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .tabs-nav button {
    white-space: nowrap;
    flex-shrink: 0;
  }
}
</style>