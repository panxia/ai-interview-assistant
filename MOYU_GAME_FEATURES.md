# 🐟 摸鱼游戏 - 功能完整文档

## 📖 游戏概述

"摸鱼"是一个创意性的2D画鱼游戏，玩家可以绘制自己的鱼，让它在虚拟的海底世界中自由游动，与其他玩家绘制的鱼一起生活。游戏强调个性化和社交互动，每条鱼都独一无二。

## 🎯 核心功能

### 1. 🎨 画鱼创作系统

#### 1.1 绘制工具
- **画笔颜色选择**: 提供多种预设颜色（红、青、蓝、绿等）
- **画笔粗细调节**: 1-10px可调节画笔粗细
- **实时绘制**: 支持鼠标拖拽绘制，实时显示绘制轨迹
- **画布尺寸**: 300x200像素的专用绘制区域

#### 1.2 鱼的特征定制
- **形状自定义**: 完全自由绘制鱼的形状，保持原始比例
- **颜色个性化**: 选择喜欢的颜色进行绘制
- **命名系统**: 为每条鱼起一个独特的名字（最多20字符）

#### 1.3 绘制操作
- **清空画布**: 一键清除当前绘制内容，重新开始
- **保存鱼**: 将绘制完成的鱼保存到游戏世界
- **预览功能**: 绘制过程中实时预览鱼的形状

### 2. 🌊 海底游泳世界

#### 2.1 环境设计
- **海底背景**: 蓝色渐变海底背景，营造深海氛围
- **装饰元素**: 
  - 随机气泡效果（20个半透明气泡）
  - 海草装饰（15根绿色海草）
  - 珊瑚装饰（8个橙色珊瑚）
- **动态效果**: 装饰元素随机分布，增加视觉丰富度

#### 2.2 画布交互
- **拖拽移动**: 支持鼠标和触摸拖拽移动画布视角
- **响应式设计**: 画布尺寸自动适配容器大小
- **触摸支持**: 完全兼容移动设备触摸操作

### 3. 🐠 鱼群管理系统

#### 3.1 鱼的数据结构
```typescript
interface Fish {
  id?: number              // 数据库ID
  fishId: string          // 唯一标识符
  name: string            // 鱼的名字
  color: string           // 鱼的颜色
  path: Point[]           // 绘制路径点
  position: Point         // 当前位置
  direction: number       // 游动方向
  speed: number           // 游动速度
  wiggle: number          // 摆动幅度
  createdAt: Date         // 创建时间
  updatedAt?: Date        // 更新时间
  author: string          // 作者信息
  imageData: string       // 图像数据（Base64）
  scale: number           // 缩放比例
  likes: number           // 点赞数量
  liked: boolean          // 是否已点赞
}
```

#### 3.2 鱼的行为特性
- **智能游动**: 随机方向变化，自然摆动效果
- **边界检测**: 自动避免游出画布边界
- **性能优化**: 降低动画帧率，优化计算频率
- **碰撞检测**: 支持点击检测，实现交互功能

### 4. ❤️ 社交互动系统

#### 4.1 点赞功能
- **点击点赞**: 点击任意鱼即可点赞/取消点赞
- **视觉反馈**: 点赞时显示爱心动画效果
- **状态同步**: 点赞状态实时同步到后端
- **触摸支持**: 移动设备触摸点赞

#### 4.2 实时数据同步
- **定时同步**: 每5秒自动同步鱼群数据
- **状态保持**: 保持本地点赞状态和位置信息
- **实时更新**: 新鱼加入时立即显示

### 5. 🔧 技术特性

#### 5.1 画布技术
- **HTML5 Canvas**: 使用原生Canvas API实现2D绘制
- **双画布系统**: 分离绘制画布和显示画布
- **图像缓存**: 预加载鱼群图像，提升渲染性能
- **响应式设计**: 自动适配不同屏幕尺寸

#### 5.2 性能优化
- **动画优化**: 降低重绘频率，优化计算逻辑
- **内存管理**: 及时清理不需要的图像资源
- **触摸优化**: 增大触摸区域，提升移动体验
- **渲染优化**: 分离更新逻辑和绘制逻辑

#### 5.3 兼容性
- **浏览器支持**: 支持现代浏览器（Chrome、Firefox、Safari、Edge）
- **移动适配**: 完全兼容手机和平板设备
- **触摸事件**: 支持触摸拖拽和触摸点赞

### 6. ⌨️ 操作控制

#### 6.1 键盘快捷键
- **空格键**: 清空绘制画布
- **回车键**: 保存当前绘制的鱼
- **Ctrl/Cmd + R**: 重置视图

#### 6.2 鼠标操作
- **左键拖拽**: 绘制鱼的形状
- **拖拽画布**: 移动游泳区域视角
- **点击鱼**: 点赞/取消点赞

#### 6.3 触摸操作
- **单指绘制**: 在绘制区域绘制鱼
- **双指拖拽**: 移动游泳区域
- **触摸点赞**: 触摸鱼进行点赞

### 7. 🌐 数据持久化

#### 7.1 后端存储
- **RESTful API**: 标准的HTTP接口设计
- **内存存储**: 使用ConcurrentHashMap进行高性能内存存储
- **数据同步**: 支持多用户实时数据共享
- **错误处理**: 完善的异常处理和错误恢复

#### 7.2 数据同步
- **实时同步**: 5秒间隔的自动数据同步
- **状态保持**: 保持用户交互状态
- **冲突解决**: 智能处理数据冲突

### 8. 🎮 游戏体验

#### 8.1 视觉设计
- **现代UI**: 简洁美观的用户界面
- **动画效果**: 流畅的游动动画和交互反馈
- **色彩搭配**: 和谐的海洋主题色彩
- **响应式布局**: 自适应不同屏幕尺寸

#### 8.2 交互体验
- **直观操作**: 简单易用的绘制工具
- **即时反馈**: 所有操作都有视觉反馈
- **流畅动画**: 60fps的流畅动画体验
- **触摸友好**: 移动设备友好的触摸操作

## 🚀 技术架构

### 前端技术栈
- **Vue 3**: 使用Composition API构建响应式界面
- **TypeScript**: 提供类型安全和开发体验
- **HTML5 Canvas**: 实现2D图形绘制和动画
- **CSS3**: 现代CSS特性实现视觉效果

### 后端技术栈
- **Spring Boot**: Java企业级应用框架
- **内存存储**: 高性能的并发数据结构
- **RESTful API**: 标准的Web服务接口
- **CORS支持**: 跨域资源共享支持

### 数据流程
1. 用户绘制鱼 → 保存到后端
2. 后端存储鱼数据 → 返回成功响应
3. 前端获取鱼群数据 → 渲染到画布
4. 实时同步更新 → 保持数据一致性

## 📱 使用说明

### 开始游戏
1. 进入游戏页面，点击"🌊 鱼群游泳区域"头部
2. 显示画鱼工具，选择画笔颜色和粗细
3. 在绘制区域绘制你的鱼
4. 输入鱼的名字，点击"保存鱼"
5. 隐藏画鱼工具，观看你的鱼在海底游动

### 互动操作
- **点赞鱼**: 点击任意鱼即可点赞
- **移动视角**: 拖拽画布移动视角
- **查看信息**: 调试模式下查看画布和鱼群信息

### 移动设备
- 绘制功能默认隐藏，增大游泳区域
- 支持触摸绘制和触摸点赞
- 响应式设计，自动适配屏幕尺寸

## 🔮 未来扩展

### 功能增强
- **鱼群AI**: 更智能的游动行为
- **环境互动**: 鱼群与环境元素的互动
- **成就系统**: 解锁特殊鱼种和装饰
- **多人协作**: 实时多人绘制功能

### 技术优化
- **WebGL渲染**: 提升3D效果和性能
- **PWA支持**: 离线游戏体验
- **云存储**: 云端数据同步
- **AI生成**: AI辅助绘制功能

## 📊 性能指标

- **动画帧率**: 60fps流畅动画
- **响应时间**: <100ms操作响应
- **内存占用**: 优化的内存管理
- **加载速度**: 快速初始化加载

## 🐛 已知问题

- 画布初始化时序问题（已优化）
- TypeScript类型推断警告（不影响功能）
- 移动设备性能优化（持续改进）

## 📞 技术支持

如有问题或建议，请通过以下方式联系：
- 提交Issue到项目仓库
- 查看控制台错误日志
- 检查网络连接状态

---

*最后更新: 2024年12月*
*版本: 1.0.0*
